{% extends 'mainBase.html' %}
{% block title %}
Perfil jubilado
{% endblock title %}
{% block body %}
<div class="row">
    <div class="col s8 offset-s2">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
                <span class="card-title">Parte medica</span>
                <p>I am a very simple card. I am good at containing small bits of information.
                I am convenient because I require little markup to use effectively.</p>
            </div>
            {% if retired.getAppointments %}
                <ul class="collapsible">
                    {% for appointment in retired.getAppointments %}
                        <li>
                            <div class="collapsible-header"><i class="material-icons">favorite_border</i>Turno: {{ appointment }}</div>
                            <div class="collapsible-body white">
                                <p>
                                    hora: {{ appointment.timeAttendance }}
                                </p>
                                <p>
                                    doctor: {{ appointment.workday.doctor }}
                                </p>
                                <button class="btn btn-flat" id="btn-{{ appointment_id }}" onclick="deleteAppointment({{ appointment.id }})">Cancelar</button>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="card-action">
            <a class="btn btn-flat" href="{% url 'appointments' %}">Ir</a>
            </div>
        </div>
    </div>
    <div class="col s8 offset-s2">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
                <span class="card-title">Parte educativa</span>
                <p>I am a very simple card. I am good at containing small bits of information.
                I am convenient because I require little markup to use effectively.</p>
            </div>
            {% if retired.getEnrrolments %}
                <ul class="collapsible">
                    {% for enrrolment in retired.getEnrrolments %}
                        <li>
                            <div class="collapsible-header"><i class="material-icons">book</i>Clase {{ enrrolment }}</div>
                            {% if enrrolment.nextDay %}
                                <div class="collapsible-body white">
                                    <p>
                                        hora: {{ enrrolment.nextDay.start_hour }}
                                    </p>
                                    <p>
                                        profesor: {{ enrrolment.classroom.teacher }}
                                    </p>
                                </div>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="card-action">
                <a class="btn btn-flat" href="{% url 'classrooms' %}">Ir</a>
            </div>
        </div>
      </div>
      <div class="col s12">

      </div>
</div>
<script>
$(document).ready(function(){
    $('.collapsible').collapsible();
});
function deleteAppointment(appointment_id){
    $.ajax({
        type: "POST",
        url: "{% url 'deleteAppointment' %}",   
        data: {
            csrfmiddlewaretoken: '{{ csrf_token }}',
            appointment_id:appointment_id
        },
        success: function(result){
            window.location.href = "{% url 'profile' %}"; 
        },
        error: function (request, status, error) {
            alert(request.responseText);
        }
    })
}
</script>
{% endblock body %}